<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>SkyTicket - Trang Ch√≠nh</title>
    <link rel="stylesheet" th:href="@{/admin.css}">
</head>
<body>

<div th:if="${loginSuccess}" id="successNotification" class="success-notification">
    <div class="success-icon"></div>
    <div class="success-content">
        <div class="success-title">üéâ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!</div>
        <div class="success-message">
            <span th:if="${admin != null and admin.fullName != null}"
                  th:text="'Ch√∫c m·ª´ng b·∫°n ' + ${admin.fullName} + '!'">Ch√∫c m·ª´ng b·∫°n!</span>
            <span th:if="${admin == null or admin.fullName == null}">Ch√∫c m·ª´ng b·∫°n!</span>
        </div>
    </div>
    <button class="success-close" onclick="closeNotification()">√ó</button>
</div>

<header>
    <h2>‚úàÔ∏è SkyTicket - H·ªá Th·ªëng ƒê·∫∑t V√© M√°y Bay</h2>

    <span th:if="${admin != null}" th:text="${admin.fullName}">Admin</span>
</header>


<main>
    <nav class="navbar">
        <div class="navbar-center">
            <a th:href="@{/schedule/admin}" class="nav-link">üè† Trang ch·ªß</a>
            <a th:href="@{/schedule/admin/users}" class="nav-link">üë§ Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a>
            <a th:href="@{/schedule/addSchedule}" class="nav-link">üõ´ Th√™m l·ªãch bay</a>
<!--            <a th:href="@{/schedule/payment}" class="nav-link">Giao d·ªãch</a>-->
            <a th:href="@{/schedule/admin/bookings}" class="nav-link">Qu·∫£n l√Ω v√© m√°y bay</a>
        </div>
        <div class="navbar-right">

            <a th:href="@{/logout}" class="logout-btn">ƒêƒÉng xu·∫•t</a>
        </div>
    </nav>
    <div class="header">
        <div class="search-section">
            <form th:action="@{/flight/search}" method="get" class="search-form" id="searchForm">
                <div class="form-group">
                    <label for="departure">ƒêi·ªÉm ƒëi:</label>
                    <select id="departure" name="departure" class="form-control" th:value="${departure}" required>
                        <option value="">Ch·ªçn ƒëi·ªÉm ƒëi</option>
                        <option th:each="airport : ${airports}"
                                th:value="${airport.code}"
                                th:text="${airport.code} + ' - ' + ${airport.airportName} + ' (' + ${airport.location} + ')'"
                                th:selected="${airport.code == departure}"></option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="destination">ƒêi·ªÉm ƒë·∫øn:</label>
                    <select id="destination" name="destination" class="form-control" th:value="${destination}" required>
                        <option value="">Ch·ªçn ƒëi·ªÉm ƒë·∫øn</option>
                        <option th:each="airport : ${airports}"
                                th:value="${airport.code}"
                                th:text="${airport.code} + ' - ' + ${airport.airportName} + ' (' + ${airport.location} + ')'"
                                th:selected="${airport.code == destination}"></option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date">Ng√†y c·∫•t c√°nh:</label>
                    <input type="date" id="date" name="date"
                           th:value="${#temporals.format(date, 'yyyy-MM-dd')}" required>
                </div>

                <div class="form-group">
                    <label for="seatClass">H·∫°ng gh·∫ø:</label>
                    <select id="seatClass" name="seatClass">
                        <option value="" th:selected="${seatClass == null or seatClass == ''}">T·∫•t c·∫£</option>
                        <option value="Economy" th:selected="${seatClass == 'Economy'}">Economy</option>
                        <option value="Business" th:selected="${seatClass == 'Business'}">Business</option>
                    </select>
                </div>

                <input name="page" id="page" type="hidden" th:value="1">

                <button type="submit" class="btn btn-primary">üîç T√¨m chuy·∫øn bay</button>
                <a id="link" th:href="@{/schedule/admin}" class="btn btn-secondary">T·∫•t c·∫£ chuy·∫øn bay</a>
            </form>
        </div>

        <div class="heading">
            <h1>Ô∏è Danh s√°ch L·ªãch bay</h1>
        </div>
    </div>

    <div class="table-card">
        <div class="table-wrapper">
            <table>
                <thead>
                <tr>
                    <th>H√£ng h√†ng kh√¥ng</th>
                    <th>S√¢n bay ƒëi</th>
                    <th>ƒêi·ªÉm c·∫•t c√°nh</th>
                    <th>ƒêi·ªÉm h·∫° c√°nh</th>
                    <th>Ng√†y c·∫•t c√°nh</th>
                    <th>Gi·ªù c·∫•t c√°nh</th>
                    <th>Ng√†y h·∫° c√°nh</th>
                    <th>Gi·ªù h·∫° c√°nh</th>
                    <th>Lo·∫°i gh·∫ø</th>
                    <th>S·ªë gh·∫ø</th>
                    <th>Gi√° v√©</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Ch·ªânh s·ª≠a</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="flight : ${flights}">
                    <td th:text="${flight.plane.planeModel}">Airbus A321</td>
                    <td th:text="${flight.plane.airport.airportName}">T√¢n S∆°n Nh·∫•t</td>
                    <td th:text="${flight.takeOff}">SGN</td>
                    <td th:text="${flight.land}">HAN</td>
                    <td th:text="${#temporals.format(flight.takeOffDate, 'dd-MM-yyyy')}">01-01-2025</td>
                    <td th:text="${#temporals.format(flight.takeOffHour, 'HH:mm')}">08:00</td>
                    <td th:text="${#temporals.format(flight.landDate, 'dd-MM-yyyy')}">01-01-2025</td>
                    <td th:text="${#temporals.format(flight.landHour, 'HH:mm')}">10:00</td>
                    <td th:text="${flight.flightSchedule.seatClass}">Economy</td>
                    <td class="num" th:text="${flight.flightSchedule.seatNumber}">1</td>
                    <td class="num" th:text="${flight.flightSchedule.price}"></td>
                    <td>
                        <span th:switch="${flight.plane.status}">
                            <span th:case="'Scheduled'" class="status-badge status-scheduled"
                                  th:text="${flight.plane.status}">Scheduled</span>
                            <span th:case="'Ongoing'" class="status-badge status-ongoing"
                                  th:text="${flight.plane.status}">Ongoing</span>
                            <span th:case="'Completed'" class="status-badge status-completed"
                                  th:text="${flight.plane.status}">Completed</span>
                            <span th:case="*" class="status-badge status-cancelled" th:text="${flight.plane.status}">Cancelled</span>
                        </span>

                    </td>
                    <td>
                        <a th:href="@{'/schedule/editSchedule/' +${flight.flightPlaneId}}" class="btn">Edit Schedule</a>
                        <a th:href="@{'/schedule/deleteSchedule/' +${flight.flightPlaneId}}" class="btn"
                           onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªãch bay n√†y?');">Delete</a>
                    </td>
                </tr>
                <tr th:if="${flights == null or flights.isEmpty()}">
                    <td colspan="13">
                        <div class="empty-state">
                            <div class="empty-state-icon">üì≠</div>
                            <p>Kh√¥ng c√≥ l·ªãch bay n√†o.</p>
                            <small>Vui l√≤ng quay l·∫°i sau ho·∫∑c li√™n h·ªá h·ªó tr·ª£ kh√°ch h√†ng.</small>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</main>

<footer>
    <p>¬© 2025 SkyTicket. All rights reserved.</p>
</footer>

<script>
    const notification = document.getElementById('successNotification');
    if (notification) {
        setTimeout(() => {
            closeNotification();
        }, 5000);
    }

    function closeNotification() {
        const notification = document.getElementById('successNotification');
        if (notification) {
            notification.classList.add('hide');
            setTimeout(() => {
                notification.remove();
            }, 500);
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const searchForm = document.getElementById('searchForm');
        const dateInput = document.getElementById('date');

        if (searchForm) {
            searchForm.addEventListener('submit', function (event) {
                // S·ª≠a l·ªói: L·∫•y gi√° tr·ªã t·ª´ c√°c th·∫ª <select>
                const departure = document.getElementById('departure').value;
                const destination = document.getElementById('destination').value;

                if (departure && destination && departure === destination) {
                    event.preventDefault();
                    alert('ƒêi·ªÉm ƒëi v√† ƒêi·ªÉm ƒë·∫øn kh√¥ng ƒë∆∞·ª£c tr√πng nhau. Vui l√≤ng ch·ªçn l·∫°i.');
                }
            });
        }

        // kh√¥ng cho ph√©p ch·ªçn ng√†y trong qu√° kh·ª©
        if (dateInput) {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');

            const minDate = `${year}-${month}-${day}`;

            dateInput.min = minDate;

            if (dateInput.value && dateInput.value < minDate) {
                dateInput.value = minDate;
            }
        }
    });
</script>
</body>
</html>